<!-- src/app/components/expenses/expenses.component.html -->
<!-- SIMPLIFIED VERSION - Single table view -->

<app-header></app-header>
<app-sidebar></app-sidebar>

<div class="main-layout">
  <section class="content">
    <!-- Page Header -->
    <div class="page-header">
      <h1>Putni Troškovi</h1>
      <div class="page-actions">
        <button class="btn btn-create" (click)="openModal()">
          <i class="fas fa-plus"></i>
          Kreiraj izvješće
        </button>
      </div>
    </div>

<div class="filter-section">
  <button class="mobile-filter-toggle" [class.active]="isMobileFiltersOpen" (click)="toggleMobileFilters()">
    <i class="fas fa-filter"></i>
    {{ isMobileFiltersOpen ? 'Sakrij filtere' : 'Prikaži filtere' }}
    <i class="fas fa-chevron-down"></i>
  </button>

  <div class="filter-content" [class.open]="isMobileFiltersOpen">
    <div class="filter-row">
      <div class="filter-group">
        <label>ID</label>
        <input type="text" class="form-control" placeholder="Pretraži po ID-u" 
               [(ngModel)]="filterValues.id" (input)="applyFilters()" />
      </div>

      <div class="filter-group">
        <label>Vrsta</label>
        <select class="form-control" [(ngModel)]="filterValues.type" (change)="applyFilters()">
          <option value="">Sve vrste</option>
          <option value="Troškovno izvješće Sutca">Troškovno izvješće Sutca</option>
          <option value="Troškovno izvješće Delegata">Troškovno izvješće Delegata</option>
          <option value="Troškovno izvješće Pomoćnog Sutca">Troškovno izvješće Pomoćnog Sutca</option>
        </select>
      </div>

      <div class="filter-group">
        <label>Korisnik</label>
        <input type="text" class="form-control" placeholder="Pretraži po korisniku" 
               [(ngModel)]="filterValues.userName" (input)="applyFilters()" />
      </div>

      <div class="filter-group">
        <label>Godina</label>
        <select class="form-control" [(ngModel)]="filterValues.year" (change)="applyFilters()">
          <option value="">Sve godine</option>
          <option value="2025">2025</option>
          <option value="2024">2024</option>
          <option value="2023">2023</option>
        </select>
      </div>

      <div class="filter-group">
        <label>Mjesec</label>
        <select class="form-control" [(ngModel)]="filterValues.month" (change)="applyFilters()">
          <option value="">Svi mjeseci</option>
          <option value="Siječanj">Siječanj</option>
          <option value="Veljača">Veljača</option>
          <option value="Ožujak">Ožujak</option>
          <option value="Travanj">Travanj</option>
          <option value="Svibanj">Svibanj</option>
          <option value="Lipanj">Lipanj</option>
          <option value="Srpanj">Srpanj</option>
          <option value="Kolovoz">Kolovoz</option>
          <option value="Rujan">Rujan</option>
          <option value="Listopad">Listopad</option>
          <option value="Studeni">Studeni</option>
          <option value="Prosinac">Prosinac</option>
        </select>
      </div>

      <div class="filter-group">
        <label>Status</label>
        <select class="form-control" [(ngModel)]="filterValues.state" (change)="applyFilters()">
          <option value="">Svi statusi</option>
          <option value="Skica">Skica</option>
          <option value="Predano">Predano</option>
          <option value="Potvrđeno">Potvrđeno</option>
          <option value="Odbijeno">Odbijeno</option>
        </select>
      </div>

      <div class="filter-group">
        <button class="btn btn-outline-secondary filter-btn" (click)="clearFilters()">
          <i class="fas fa-times"></i> Očisti
        </button>
      </div>
    </div>
  </div>
</div>

    <!-- Main Table -->
    <div class="table-section">
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Vrsta</th>
              <th>Korisnik</th>
              <th>Godina</th>
              <th>Mjesec</th>
              <!-- <th>Status</th> -->
              <th>Iznos</th>
              <th>Datum kreiranja</th>
              <th>Opcije</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let expense of displayedExpenses; trackBy: trackByExpenseId">
              <td>{{ expense.id }}</td>
              <td>{{ expense.type }}</td>
              <td>{{ expense.userName }} {{ expense.userSurname }}</td>
              <td>{{ expense.year }}</td>
              <td>{{ expense.month }}</td>
              <!-- <td>
                <span class="status-badge" [ngClass]="getStateClass(expense.state)">
                  <i class="fas" [ngClass]="getStateIcon(expense.state)"></i>
                  {{ expense.state }}
                </span>
              </td> -->
              <td class="amount-cell">{{ formatAmount(expense.totalAmount) }}</td>
              <td>{{ formatDate(expense.createdAt!) }}</td>
              <td>
                <div class="action-buttons">
                  <button class="btn-icon btn-view" title="Pregled" (click)="editTravelExpense(expense)">
                    <i class="fas fa-eye"></i>
                  </button>
                  
                  

                  <button class="btn-icon btn-delete" 
                          title="Obriši" 
                          (click)="openDeleteModal(expense)">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="displayedExpenses.length === 0">
              <td colspan="9" class="text-center">
                {{ filterValues.id || filterValues.type || filterValues.userName || filterValues.year || filterValues.month || filterValues.state 
                   ? 'Nema izvješća koja odgovaraju odabranim filterima.' 
                   : 'Nema kreiran ih izvješća.' }}
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Pagination -->
        <div class="pagination-container" *ngIf="totalPages > 1">
          <div class="pagination-info">
            Prikazano {{ displayedExpenses.length }} od {{ travelExpenses.length }} •
            Stranica {{ currentPage }} od {{ totalPages }}
          </div>
          <div class="pagination">
            <button class="page-btn" [disabled]="currentPage === 1" (click)="goToPage(currentPage - 1)">
              <i class="fas fa-chevron-left"></i>
            </button>

            <button class="page-btn" 
                    *ngFor="let page of getPages()" 
                    [class.active]="page === currentPage"
                    (click)="goToPage(page)">
              {{ page }}
            </button>

            <button class="page-btn" [disabled]="currentPage === totalPages" (click)="goToPage(currentPage + 1)">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Toast Notifications -->
<div class="toast-container">
  <div *ngIf="successMessage" class="toast toast-success">
    <span class="toast-emoji">✅</span>
    <span class="toast-message">{{ successMessage }}</span>
    <button class="toast-close" (click)="clearMessages()">
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>

  <div *ngIf="errorMessage" class="toast toast-error">
    <span class="toast-emoji">❌</span>
    <span class="toast-message">{{ errorMessage }}</span>
    <button class="toast-close" (click)="clearMessages()">
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
</div>

<!-- Modals -->
<app-expenses-modal
  [isOpen]="isModalOpen"
  (close)="closeModal()"
  (success)="onReportCreated($event)">
</app-expenses-modal>

<app-delete-expenses-modal
  [isOpen]="isDeleteModalOpen"
  [expenseToDelete]="expenseToDelete"
  (close)="closeDeleteModal()"
  (deleteConfirmed)="onDeleteConfirmed($any($event))">
</app-delete-expenses-modal>

<app-footer></app-footer>