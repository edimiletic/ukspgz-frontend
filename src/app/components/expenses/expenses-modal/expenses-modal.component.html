<!-- src/app/components/expenses/expenses-modal/expenses-modal.component.html -->
<div class="modal-overlay" *ngIf="isOpen" (click)="onBackdropClick($event)">
  <div class="modal-container">
    <div class="modal-header">
      <h3>Novo Izvješće</h3>
      <button class="close-btn" (click)="onClose()"><i class="fa-solid fa-xmark"></i></button>
    </div>
    
    <div class="modal-body">
      <!-- Error Message in Modal -->
      <div *ngIf="errorMessage" class="alert alert-error">
        {{ errorMessage }}
      </div>

      <!-- Loading State for User Data -->
      <div *ngIf="isLoadingUser" class="loading-container">
        <div class="loading-spinner"></div>
        <p>Učitavanje korisničkih podataka...</p>
      </div>

      <!-- Form Content -->
      <form *ngIf="!isLoadingUser">
        <!-- User Selection (Admin Only) -->
        <div class="form-group" *ngIf="isAdmin">
          <label for="userId">Korisnik<span class="required">*</span></label>
          <div class="select-wrapper">
            <select 
              id="userId" 
              class="form-control" 
              [(ngModel)]="reportData.userId"
              name="userId"
              (change)="onUserSelected()"
              required
              [disabled]="isLoading">
              <option value="">Odaberite korisnika</option>
              <option 
                *ngFor="let user of filteredUsers" 
                [value]="user._id">
                {{ getUserDisplayName(user) }}
              </option>
            </select>
            <i class="fas fa-chevron-down select-arrow"></i>
          </div>
          <!-- <small class="form-help-text">
            Odaberite korisnika za kojeg kreirate izvješće
          </small> -->
        </div>

        <!-- Report Type
        <div class="form-group">
          <label for="reportType">Tip Izvješća<span class="required">*</span></label>
          <div class="select-wrapper">
            <select 
              id="reportType" 
              class="form-control" 
              [(ngModel)]="reportData.type"
              name="reportType"
              required
              [disabled]="isLoading || (isAdmin && !reportData.userId)">
              <option value="" *ngIf="reportTypes.length > 1">Odaberite tip izvješća</option>
              <option 
                *ngFor="let type of reportTypes" 
                [value]="type">
                {{ type }}
              </option>
              <option value="" disabled *ngIf="reportTypes.length === 0">
                Nema dostupnih tipova izvješća
              </option>
            </select>
            <i class="fas fa-chevron-down select-arrow"></i>
          </div>
        </div> -->

        <!-- Season -->
        <div class="form-group">
          <label for="season">Sezona<span class="required">*</span></label>
          <div class="select-wrapper">
            <select 
              id="season" 
              class="form-control" 
              [(ngModel)]="reportData.season"
              name="season"
              required
              [disabled]="isLoading">
              <option 
                *ngFor="let season of seasons" 
                [value]="season">
                {{ season }}
              </option>
            </select>
            <i class="fas fa-chevron-down select-arrow"></i>
          </div>
        </div>

        <!-- Year and Month Row -->
        <div class="form-row">
          <div class="form-group">
            <label for="year">Godina<span class="required">*</span></label>
            <div class="select-wrapper">
              <select 
                id="year" 
                class="form-control" 
                [(ngModel)]="reportData.year"
                name="year"
                required
                [disabled]="isLoading">
                <option 
                  *ngFor="let year of years" 
                  [value]="year">
                  {{ year }}
                </option>
              </select>
              <i class="fas fa-chevron-down select-arrow"></i>
            </div>
          </div>

          <div class="form-group">
            <label for="month">Mjesec<span class="required">*</span></label>
            <div class="select-wrapper">
              <select 
                id="month" 
                class="form-control" 
                [(ngModel)]="reportData.month"
                name="month"
                required
                [disabled]="isLoading">
                <option value="">Odaberite mjesec</option>
                <option 
                  *ngFor="let month of months" 
                  [value]="month">
                  {{ month }}
                </option>
              </select>
              <i class="fas fa-chevron-down select-arrow"></i>
            </div>
          </div>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button 
        class="btn btn-secondary" 
        (click)="onClose()"
        [disabled]="isLoading">
        Odustani
      </button>
      <button 
        class="btn btn-primary" 
        (click)="onSave()"
        [disabled]="!isFormValid() || isLoading || isLoadingUser">
        <span *ngIf="isLoading">Spremanje...</span>
        <span *ngIf="!isLoading">Spremi</span>
      </button>
    </div>
  </div>
</div>