<!-- Updated src/app/components/games-assigned/games-assigned.component.html -->
<app-header></app-header>
<div class="main-layout">
  <!-- Sidebar -->
  <nav class="sidebar">
    <ul>
      <li><a href="/home">Početna stranica</a></li>
      <li><a class="active" href="/assigned">Moje utakmice</a></li>
      <li><a href="/absence">Odsustvo</a></li>
      <li><a href="/expenses">Putni troškovi</a></li>
      <li><a href="/rules">Dokumenti</a></li>
      <li><a href="#">Ispiti</a></li>
      <li><a href="#">Upute za korištenje sustava</a></li>
    </ul>
  </nav>
  
  <!-- Content -->
  <section class="content">
    <!-- Admin Create Game Button -->
    <div *ngIf="isAdmin() && !isLoading" class="admin-actions">
      <h1 class="admin-title">Sve Utakmice</h1>
      <button class="btn btn-primary btn-create-game" (click)="openCreateGameModal()">
        <i class="fas fa-plus"></i>
        Kreiraj Utakmicu
      </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="loading-spinner"></div>
      <p>Učitavanje utakmica...</p>
    </div>

    <!-- Main Content -->
    <div *ngIf="!isLoading">
      <!-- Pending Nominations Section -->
      <div class="description">
        <h2 *ngIf="!isAdmin()">Nominacije koje čekaju odluku</h2>
        <h2 *ngIf="isAdmin()">Nadolazeće Utakmice</h2>
        <div *ngIf="pendingGames.length === 0" class="no-games">
          <p *ngIf="!isAdmin()">Nema nominacija na čekanju</p>
          <p *ngIf="isAdmin()">Nema nadolazećih utakmica</p>
        </div>
        <div *ngIf="pendingGames.length > 0" class="table-container">
          <table class="table">
            <thead>
              <tr>
                <th>Datum</th>
                <th>Vrijeme</th>
                <th>Mjesto</th>
                <th>Natjecanje</th>
                <th>Ekipe</th>
                <th *ngIf="!isAdmin()">Moja uloga</th>
                <th>Sudački tim</th>
                <th *ngIf="!isAdmin()">Akcije</th>
                <th *ngIf="isAdmin()">Status</th>
                <th *ngIf="isAdmin()">Akcije</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let game of pendingGames">
                <td>{{ formatDate(game.date) }}</td>
                <td>{{ game.time }}</td>
                <td>{{ game.venue }}</td>
                <td>{{ game.competition }}</td>
                <td>{{ getTeamsDisplay(game) }}</td>
                <td *ngIf="!isAdmin()">{{ getMyRole(game) }}</td>
                <td>
                  <div class="referees-summary" [innerHTML]="getAllRefereesFormatted(game)">
                  </div>
                </td>
                <td *ngIf="!isAdmin()">
                  <div class="action-buttons">
                    <button class="btn btn-success btn-sm" (click)="acceptAssignment(game._id)" title="Prihvati">
                      <i class="fas fa-check"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" (click)="rejectAssignment(game._id)" title="Odbij">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </td>
                <td *ngIf="isAdmin()">
                  <span [class]="getStatusClass(game)">
                    {{ getStatusDisplay(game) }}
                  </span>
                </td>
                <td *ngIf="isAdmin()">
                  <div class="admin-action-buttons">
                    <button class="btn btn-warning btn-sm" (click)="editGame(game)" title="Uredi utakmicu">
                      <i class="fas fa-pen"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" (click)="deleteGame(game)" title="Obriši utakmicu">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Confirmed Nominations Section - Only show for non-admin users -->
      <div class="description" *ngIf="!isAdmin()">
        <h2>Potvrđene nominacije</h2>
        <div *ngIf="confirmedGames.length === 0" class="no-games">
          <p>Nema potvrđenih nominacija</p>
        </div>
        <div *ngIf="confirmedGames.length > 0" class="table-container">
          <table class="table">
            <thead>
              <tr>
                <th>Datum</th>
                <th>Vrijeme</th>
                <th>Mjesto</th>
                <th>Natjecanje</th>
                <th>Ekipe</th>
                <th>Moja uloga</th>
                <th>Sudački tim</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let game of confirmedGames">
                <td>{{ formatDate(game.date) }}</td>
                <td>{{ game.time }}</td>
                <td>{{ game.venue }}</td>
                <td>{{ game.competition }}</td>
                <td>{{ getTeamsDisplay(game) }}</td>
                <td>{{ getMyRole(game) }}</td>
                <td>
                  <div class="referees-summary" [innerHTML]="getAllRefereesFormatted(game)">
                  </div>
                </td>
                <td>
                  <span class="status-badge status-accepted">Potvrđeno</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Game History Section -->
      <div class="description">
        <h3>Povijest utakmica</h3>
        <div *ngIf="gameHistory.length === 0" class="no-games">
          <p>Nema povijesti utakmica</p>
        </div>
        <div *ngIf="gameHistory.length > 0" class="table-container">
          <table class="table">
            <thead>
              <tr>
                <th>Datum</th>
                <th>Vrijeme</th>
                <th>Mjesto</th>
                <th>Natjecanje</th>
                <th>Ekipe</th>
                <th>Moja uloga</th>
                <th>Sudački tim</th>
                <th>Status</th>
                <!-- <th>Rezultat</th> -->
                <th *ngIf="isAdmin()">Akcije</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let game of gameHistory" [class]="getStatusClass(game)">
                <td>{{ formatDate(game.date) }}</td>
                <td>{{ game.time }}</td>
                <td>{{ game.venue }}</td>
                <td>{{ game.competition }}</td>
                <td>{{ getTeamsDisplay(game) }}</td>
                <td *ngIf="!isAdmin()">{{ getMyRole(game) }}</td>
                <td>
                  <div class="referees-summary" [innerHTML]="getAllRefereesFormatted(game)">
                  </div>
                </td>
                <td>
                  <span [class]="getStatusClass(game)">
                    {{ getStatusDisplay(game) }}
                  </span>
                </td>
                <!-- <td>{{ getScoreDisplay(game) }}</td> -->
                <td *ngIf="isAdmin()">
                  <div class="admin-action-buttons">
                    <button class="btn btn-warning btn-sm" (click)="editGame(game)" title="Uredi utakmicu">
                      <i class="fas fa-pen"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" (click)="deleteGame(game)" title="Obriši utakmicu">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Toast Notifications -->
<div class="toast-container">
  <div *ngIf="successMessage" class="toast toast-success">
    <span class="toast-emoji">✅</span>
    <span class="toast-message">{{ successMessage }}</span>
    <button class="toast-close" (click)="clearMessages()"><i class="fa-solid fa-xmark"></i></button>
  </div>
  
  <div *ngIf="errorMessage" class="toast toast-error">
    <span class="toast-emoji">❌</span>
    <span class="toast-message">{{ errorMessage }}</span>
    <button class="toast-close" (click)="clearMessages()"><i class="fa-solid fa-xmark"></i></button>
  </div>
</div>

<!-- Rejection Modal -->
<app-rejection-modal
  [isOpen]="isRejectionModalOpen"
  [gameInfo]="gameToReject"
  (close)="closeRejectionModal()"
  (reject)="onRejectionConfirmed($event)">
</app-rejection-modal>

<!-- Create Game Modal -->
<app-create-game-modal
  [isOpen]="isCreateGameModalOpen"
  (close)="closeCreateGameModal()"
  (gameCreated)="onGameCreated($event)">
</app-create-game-modal>

<!-- Edit Game Modal -->
<app-edit-game-modal
  [isOpen]="isEditGameModalOpen"
  [game]="gameToEdit"
  (close)="closeEditGameModal()"
  (gameUpdated)="onGameUpdated($event)">
</app-edit-game-modal>

<!-- Confirmation Modal -->
<app-delete-game-modal
  [isOpen]="isConfirmationModalOpen"
  [confirmationData]="confirmationData"
  (close)="closeConfirmationModal()"
  (confirm)="onDeleteConfirmed($event)">
</app-delete-game-modal>

<app-footer></app-footer>